/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
var App = (function(window){
  "use strict";	
  var _this = null;
  var cacheCollection = {};

  return {
  	init : function(){
      _this = this;

      /* MENU */
	  this.MenuToggle();

	  /* FILTER */
	  this.FilterToggle();

	  /* FILTER SELECTOR*/
	  this.FilterSelector();	

	  /* MAIN SLIDER */
	  this.MainSlider();

	  /* CONTACT FORM */
	  this.ContactForm(); 

	  _this.getObject(window).resize(function() {
	  	_this.getObject("#map").height($(".k-contact_info").outerHeight());
	  }); 
 	  
 	  _this.getObject(window).load(function() {  
 	  		var jsm = ".js-masonry";
 	  	    if (_this.getObject(jsm).length > 0) {	
 	  			_this.getObject(jsm).masonry('reloadItems');
 	  		} 
 	  		var $container = $(".js-masonry"); 
 	  		$container.imagesLoaded(function () {
		        $container.masonry();
		    });
	  });
	  _this.getObject(document).ready(function() { 
	  		var $container = $(".js-masonry"); 
 	  		$container.imagesLoaded(function () {
		        $container.masonry();
		    });
	  });

	  var container = document.querySelector('.js-masonry');
	  var msnry = null; 

    },

    getObject: function(selector){
      if(typeof cacheCollection[selector] == "undefined"){
        cacheCollection[selector] = $(selector);
      }
      return cacheCollection[selector];
    },

    MenuToggle: function(){
    	var knv = ".k-nav_section";
		_this.getObject(".k-menu_icon").on('click', function(event) {
			_this.getObject(knv).fadeIn("slow");
		});
		_this.getObject(".k-close_menu").on('click', function(event) {
			_this.getObject(knv).fadeOut("slow");
		});
	},
	FilterToggle: function(){
		_this.getObject("#k-header_filter_select").on('click', function(event) {
			_this.getObject("#k-header_filter_option").slideToggle("slow");
		});
	},
	FilterSelector: function(){
		var khfs = "#k-header_filter_select";
		var dr   = "data-rel";
		var mbd  = ".k-masonry_blocks > div > div";
		$(document).on('click', "#k-header_filter_option li span", function(event) {
			if(typeof $(this).data("rel") != "undefined"){
				
				var this_rel = $(this).attr(dr);
				var this_text = $(this).text();

				var target_rel = $(khfs).attr(dr);
				var target_text = $(""+khfs+" > span").text();

				_this.getObject(khfs).attr(dr, this_rel);
				_this.getObject(""+khfs+" > span").text(this_text);

				$(this).attr(dr, target_rel);
				$(this).text(target_text);

				if(this_rel == "k-portfolio_all"){
					$(document).find('#k-portfolio_listing > div').fadeIn("slow");	
				}else{
					$(document).find('#k-portfolio_listing > div').fadeOut("slow");
					$(document).find('#'+this_rel).fadeIn("slow");
				}

			}else{

				var this_rel = $(this).attr('data-post');
				var this_text = $(this).text();

				var target_rel = _this.getObject(khfs).attr('data-post'); 
				var target_text = _this.getObject(""+khfs+" > span").text();

				_this.getObject(khfs).attr('data-post', this_rel);
				_this.getObject(""+khfs+" > span").text(this_text);

				$(this).attr("data-post", target_rel);
				$(this).text(target_text);	

				_this.getObject(mbd).fadeOut("slow"); 
				_this.getObject(mbd).each(function(e) { 
				  var data_strip  = $(this).data('type'); 
				  var data_types  = data_strip.split(",");   
				  if($.inArray(this_rel, data_types) !== -1){
					$(this).fadeIn('slow', function() {
						ReloadBlocks();
					});
				  }
				});
				
			}	
			_this.getObject("#k-header_filter_option").slideUp("slow");
		});
	},
	MainSlider: function(){
		var kms = "#k-main_slider";
	  if (_this.getObject(kms).length > 0) {	
		  _this.getObject(kms).owlCarousel({
		      navigation : false, // Show next and prev buttons
		      slideSpeed : 300,
		      paginationSpeed : 400,
		      singleItem:true,
		      pagination : true
		 });
		 _this.getObject(".owl-next").addClass('fa fa-long-arrow-right k-slider_arrow');
		 _this.getObject(".owl-next").html("");
	 }
	},
	ReloadBlocks: function(){   
	 	msnry = new Masonry( container,{
		    //columnWidth: 303
		    "isFitWidth": true
		});
		imagesLoaded(container, function() {
	      msnry.layout();
	    });
	},
	ContactForm: function(){ 
		var fail = ".fail";
		var succ = ".succ";
	  _this.getObject("#map").height(_this.getObject(".k-contact_info").outerHeight());

	  if (_this.getObject(fail).length > 0) {
	    var msg = location.search.split('msg=')[1];
	    if(msg=='succ'){
	      _this.getObject(succ).show();
	      _this.getObject(fail).hide();
	      _this.getObject(document).scrollTop( _this.getObject(succ).offset().top ); 
	    }else if (msg=='fail') {
	      _this.getObject(fail).show();
	      _this.getObject(succ).hide();
	      _this.getObject(document).scrollTop( _this.getObject(fail).offset().top ); 
	    }else{
	      _this.getObject(succ).hide();
	      _this.getObject(fail).hide();
	    }
	 } 
	}

  }
})(window);

$(document).ready(function($) {
  App.init();
}); 